# Non-Counter Data Processing Application

## Setup

Dependencies are managed using [`uv`](https://lithic.tech/uv).\
They are listed in `pyproject.toml`.

The backend is **FastAPI** server, which can be launched using ```uv run fastapi dev```.\
The backend expects `.env` file with environment variables (**OPENAI_API_KEY**, **BRAIN_TOKEN**).
This will start the server on `127.0.0.1:8000`.
The autogenerated FastAPI docs are on `127.0.0.1:8000/docs`.

### Structure
The entrypoint to the backend is `main.py`.
The most important base classes and runtime are located in `base.py`.
The specialized agents and data states can be found in `models.py` and `workers.py`.

### Prompts
The prompt templates are written using [`Jinja`](https://jinja.palletsprojects.com/en/stable/) templating.\
They are located in the `prompts/` directory and `prompts.py` is responsible for rendering the templates into final prompt strings.

## Frontend
Dependencies are managed using [`npm`](https://www.npmjs.com/).\
To install dependencies, run: `npm install`.

Frontend is wrriten in **Vue**, using Primevue extension. To launch the app on localhost, use `npm run dev`.

## FlowData

ParsedData
    - columns, rows

DataDescriptionData
    - begin_month_year, end_month_year, english (yes, no), title_report (yes, no), granularity (monthly, daily, other), title_identifiers
    - metrics, dimensions

TranslationData
    - metrics_translations
    - dimensions_translations

FileData
    - path, format, file_name, sheets(name, contents)

UserInfoData
    - user_comment, gitlab_issue

PlatformData
    - platform_name, exists, provider, URL

## FlowWorkers

PlatformAgentWorker (turn into brain worker?)

DataDescriptionWorker: FileData, UserInfoData -> DataDescriptionData

TranslationWorker

GitlabWorker: UserInfoData -> PlatformData, FileData

ParsingRulesWorker: DataDescriptionData, PlatformData, FileData, UserInfoData -> ParserDefinitionData, ParsedData


list vsech metrik v brainu

[{file metric: , brain metric: , translation: }] - vygeneruje to castecne data description step / translation step,
pak to zedituje uzivatel (put data) a ulozi to, zohledni se to v 